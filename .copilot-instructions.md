# GitHub Copilot Instructions

This file provides development guidelines for the **React 19 Upgrade Playground** project.

## Project Overview

- **Framework**: Next.js 16 with React 19
- **Database**: Prisma + PostgreSQL
- **API**: tRPC with end-to-end type safety
- **Styling**: Tailwind CSS
- **Testing**: Vitest (unit) + Playwright (e2e)
- **Package Manager**: pnpm

## Tech Stack

- **Frontend**: React 19, Next.js 16
- **Backend**: tRPC, Prisma ORM
- **Styling**: Tailwind CSS, PostCSS
- **Testing**: Vitest, Playwright, @testing-library
- **Linting**: ESLint
- **TypeScript**: Strict mode

## Development Commands

```bash
# Development server with database setup
pnpm dx

# Development server without migrations
pnpm dev:nomigrate

# Run unit tests
pnpm test-unit

# Run e2e tests
pnpm test-e2e

# Run all tests
pnpm test-start

# Lint code
pnpm lint

# Fix linting issues
pnpm lint-fix

# Database commands
pnpm db-seed              # Seed database
pnpm db-reset             # Reset database
pnpm migrate-dev          # Run migrations
pnpm prisma-studio       # Open Prisma Studio

# Type checking
pnpm typecheck

# Build
pnpm build
pnpm start
```

## Project Structure

```
src/
├── components/          # Reusable React components
├── features/
│   └── react19/
│       ├── demos/       # React 19 feature demonstrations
│       ├── registry.tsx # Feature registry
│       └── demos.tsx    # Demo configurations
├── pages/               # Next.js pages and API routes
├── server/              # Backend logic
│   ├── routers/         # tRPC route definitions
│   ├── context.ts       # tRPC context
│   └── prisma.ts        # Prisma client setup
├── styles/              # Global CSS
└── utils/               # Utility functions
```

## Key Files

- `package.json` - Project dependencies and scripts
- `tsconfig.json` - TypeScript configuration
- `next.config.ts` - Next.js configuration
- `tailwind.config.ts` - Tailwind CSS configuration
- `vitest.config.ts` - Vitest configuration
- `playwright.config.ts` - Playwright testing configuration
- `prisma/schema.prisma` - Database schema
- `eslint.config.mjs` - ESLint configuration

## Code Style Guidelines

### React Components

- Use **TypeScript** with proper type annotations
- Use **functional components** with hooks
- Use `forwardRef` when ref forwarding is needed
- Export components with descriptive names
- Add JSX type explicitly: `type JSX.Element`

Example:
```typescript
import { type JSX } from 'react';

const MyComponent = (): JSX.Element => {
  return <div>Content</div>;
};
```

### File Naming Conventions

- **Components**: PascalCase with `.tsx` extension
- **Utils/Hooks**: camelCase with `.ts` or `.tsx` extension
- **Tests**: `filename.test.ts` or `filename.test.tsx`
- **Styles**: lowercase with `.css` extension

### TypeScript Best Practices

- Enable strict mode
- Define interfaces for props
- Use proper return types for functions
- Avoid `any` types
- Use discriminated unions for type safety

### Styling

- Use **Tailwind CSS** for styling
- Avoid inline styles when possible
- Use responsive utilities (sm:, md:, lg:, etc.)
- Define custom colors/sizes in tailwind.config.ts if needed

## Testing Guidelines

### Unit Tests (Vitest)

- Use `describe` blocks for organizing tests
- Test behavior, not implementation
- Use meaningful test names
- Mock external dependencies

### E2E Tests (Playwright)

- Test critical user flows
- Use page objects for maintainability
- Add descriptive test names
- Tests are in `playwright/` directory

## React 19 Features

This project showcases React 19 features:

- **useActionState** - Server-client form integration
- **useOptimistic** - Optimistic state updates
- **useTransition** - Async operations
- **use()** - Unwrapping promises in components
- **Ref callbacks with cleanup** - Resource management
- **Partial Pre-rendering** - Performance optimization
- **Server Components** - Server-side rendering

See `/src/features/react19/demos/` for examples.

## API Development (tRPC)

### Creating Routes

1. Define procedures in `src/server/routers/`
2. Use `publicProcedure` or authenticated procedures
3. Use `z.object()` for validation (Zod)
4. Add to `_app.ts` router

Example:
```typescript
export const appRouter = router({
  post: postRouter,
  // Add other routers here
});
```

### Database Operations

- Use Prisma ORM in router procedures
- Query in `src/server/routers/`
- Keep database logic separate from components

## Git Workflow

- Create feature branches: `feature/description`
- Use clear commit messages
- Follow conventional commits when possible
- Keep commits atomic and logical

## Environment Variables

Create `.env` file in root with required variables:

```
DATABASE_URL=postgresql://...
```

## Common Tasks

### Add a New React 19 Demo

1. Create file in `src/features/react19/demos/feature-name.tsx`
2. Export default component with `JSX.Element` type
3. Add to registry in `src/features/react19/registry.tsx`
4. Add tests in `feature-name.test.tsx`

### Add a New tRPC Route

1. Create `src/server/routers/feature.ts`
2. Define router with procedures
3. Add to `_app.ts` router export
4. Use via tRPC client from pages/components

### Add Database Schema

1. Modify `prisma/schema.prisma`
2. Run `pnpm migrate-dev`
3. Name the migration descriptively

## Debugging Tips

- Use `console.log` for quick debugging
- Use browser DevTools for React tree inspection
- Use Prisma Studio: `pnpm prisma-studio`
- Check tRPC error responses in network tab
- Run `pnpm typecheck` to catch type errors

## Dependencies to Know

- **@trpc/react-query** - tRPC React integration
- **@prisma/client** - ORM client
- **clsx** - Conditional CSS classes
- **zod** - Schema validation
- **superjson** - JSON serialization for complex types

## Performance Considerations

- Use React.memo for expensive renders
- Leverage Next.js image optimization
- Use Partial Pre-rendering for hybrid rendering
- Minimize bundle size with code splitting
- Monitor Core Web Vitals

## Contributing

- Follow the code style guidelines above
- Write tests for new features
- Update documentation if needed
- Run full test suite before committing

## Resources

- [React 19 Docs](https://react.dev)
- [Next.js Docs](https://nextjs.org/docs)
- [tRPC Docs](https://trpc.io)
- [Prisma Docs](https://www.prisma.io/docs)
- [Tailwind CSS Docs](https://tailwindcss.com/docs)

