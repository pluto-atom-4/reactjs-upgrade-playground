# GitHub Copilot Instructions

This file provides development guidelines for the **React 19 Upgrade Playground** project.

## Project Overview

- **Framework**: Next.js 16 with React 19
- **Database**: Prisma + PostgreSQL
- **API**: tRPC with end-to-end type safety
- **Styling**: Tailwind CSS
- **Testing**: Vitest (unit) + Playwright (e2e)
- **Package Manager**: pnpm

## Tech Stack

- **Frontend**: React 19, Next.js 16
- **Backend**: tRPC, Prisma ORM
- **Styling**: Tailwind CSS, PostCSS
- **Testing**: Vitest, Playwright, @testing-library
- **Linting**: ESLint
- **TypeScript**: Strict mode

## Development Commands

```bash
# Development server with database setup
pnpm dx

# Development server without migrations
pnpm dev:nomigrate

# Run unit tests
pnpm test-unit

# Run e2e tests
pnpm test-e2e

# Run all tests
pnpm test-start

# Lint code
pnpm lint

# Fix linting issues
pnpm lint-fix

# Database commands
pnpm db-seed              # Seed database
pnpm db-reset             # Reset database
pnpm migrate-dev          # Run migrations
pnpm prisma-studio       # Open Prisma Studio

# Type checking
pnpm typecheck

# Build
pnpm build
pnpm start
```

## Project Structure

```
src/
├── components/          # Reusable React components
├── features/
│   └── react19/
│       ├── demos/       # React 19 feature demonstrations
│       ├── registry.tsx # Feature registry
│       └── demos.tsx    # Demo configurations
├── pages/               # Next.js pages and API routes
├── server/              # Backend logic
│   ├── routers/         # tRPC route definitions
│   ├── context.ts       # tRPC context
│   └── prisma.ts        # Prisma client setup
├── styles/              # Global CSS
└── utils/               # Utility functions
```

## Key Files

- `package.json` - Project dependencies and scripts
- `tsconfig.json` - TypeScript configuration
- `next.config.ts` - Next.js configuration
- `tailwind.config.ts` - Tailwind CSS configuration
- `vitest.config.ts` - Vitest configuration
- `playwright.config.ts` - Playwright testing configuration
- `prisma/schema.prisma` - Database schema
- `eslint.config.mjs` - ESLint configuration

## Code Style Guidelines

### React Components

- Use **TypeScript** with proper type annotations
- Use **functional components** with hooks
- Use `forwardRef` when ref forwarding is needed
- Export components with descriptive names
- Add JSX type explicitly: `type JSX.Element`

Example:
```typescript
import { type JSX } from 'react';

const MyComponent = (): JSX.Element => {
  return <div>Content</div>;
};
```

### File Naming Conventions

- **Components**: PascalCase with `.tsx` extension
- **Utils/Hooks**: camelCase with `.ts` or `.tsx` extension
- **Tests**: `filename.test.ts` or `filename.test.tsx`
- **Styles**: lowercase with `.css` extension

### TypeScript Best Practices

- Enable strict mode
- Define interfaces for props
- Use proper return types for functions
- Avoid `any` types
- Use discriminated unions for type safety

### Styling

- Use **Tailwind CSS** for styling
- Avoid inline styles when possible
- Use responsive utilities (sm:, md:, lg:, etc.)
- Define custom colors/sizes in tailwind.config.ts if needed

## Testing Guidelines

### Unit Tests (Vitest)

- Use `describe` blocks for organizing tests
- Test behavior, not implementation
- Use meaningful test names
- Mock external dependencies

### E2E Tests (Playwright)

- Test critical user flows
- Use page objects for maintainability
- Add descriptive test names
- Tests are in `playwright/` directory

## React 19 Features

This project showcases React 19 features:

- **useActionState** - Server-client form integration
- **useOptimistic** - Optimistic state updates
- **useTransition** - Async operations
- **use()** - Unwrapping promises in components
- **Ref callbacks with cleanup** - Resource management
- **Partial Pre-rendering** - Performance optimization
- **Server Components** - Server-side rendering

See `/src/features/react19/demos/` for examples.

## API Development (tRPC)

### Creating Routes

1. Define procedures in `src/server/routers/`
2. Use `publicProcedure` or authenticated procedures
3. Use `z.object()` for validation (Zod)
4. Add to `_app.ts` router

Example:
```typescript
export const appRouter = router({
  post: postRouter,
  // Add other routers here
});
```

### Database Operations

- Use Prisma ORM in router procedures
- Query in `src/server/routers/`
- Keep database logic separate from components

## Git Workflow

- Create feature branches: `feature/description`
- Use clear commit messages
- Follow conventional commits when possible
- Keep commits atomic and logical

## Environment Variables

Create `.env` file in root with required variables:

```
DATABASE_URL=postgresql://...
```

## Common Tasks

### Add a New React 19 Demo

1. Create file in `src/features/react19/demos/feature-name.tsx`
2. Export default component with `JSX.Element` type
3. Add to registry in `src/features/react19/registry.tsx`
4. Add tests in `feature-name.test.tsx`

### Add a New tRPC Route

1. Create `src/server/routers/feature.ts`
2. Define router with procedures
3. Add to `_app.ts` router export
4. Use via tRPC client from pages/components

### Add Database Schema

1. Modify `prisma/schema.prisma`
2. Run `pnpm migrate-dev`
3. Name the migration descriptively

## Debugging Tips

- Use `console.log` for quick debugging
- Use browser DevTools for React tree inspection
- Use Prisma Studio: `pnpm prisma-studio`
- Check tRPC error responses in network tab
- Run `pnpm typecheck` to catch type errors

## Dependencies to Know

- **@trpc/react-query** - tRPC React integration
- **@prisma/client** - ORM client
- **clsx** - Conditional CSS classes
- **zod** - Schema validation
- **superjson** - JSON serialization for complex types

## Performance Considerations

- Use React.memo for expensive renders
- Leverage Next.js image optimization
- Use Partial Pre-rendering for hybrid rendering
- Minimize bundle size with code splitting
- Monitor Core Web Vitals

## Contributing

- Follow the code style guidelines above
- Write tests for new features
- Update documentation if needed
- Run full test suite before committing

## Documentation Generation

### Generated Docs Output Path

When generating documentation or reports, save all generated files to:

```
generated/docs-copilot/
```

This directory structure should be used for:
- Feature documentation
- API documentation
- Component documentation
- Testing reports
- Performance analysis
- Migration guides
- Implementation guides

Example:
```
generated/docs-copilot/
├── features/
│   ├── react19-hooks.md
│   └── use-deferred-value.md
├── api/
│   ├── trpc-routes.md
│   └── endpoints.md
├── components/
│   ├── CustomForm.md
│   └── FormButton.md
├── reports/
│   ├── test-coverage.md
│   └── performance-audit.md
└── guides/
    ├── setup-guide.md
    ├── migration-guide.md
    └── troubleshooting.md
```

**Note**: The `generated/` directory should be added to `.gitignore` as it contains auto-generated content.

## Document Generation Suppression Rules

### ⚠️ Avoid Excessive Documentation

**IMPORTANT**: Only generate documentation when explicitly requested by the user. Follow these rules:

#### When NOT to Generate Documents

- ❌ **Do NOT** auto-generate documentation for every file or function
- ❌ **Do NOT** create comprehensive API docs unless specifically asked
- ❌ **Do NOT** generate migration guides, setup guides, or tutorials unless requested
- ❌ **Do NOT** create reports (test coverage, performance audits, etc.) unless explicitly requested
- ❌ **Do NOT** document existing code without user instruction
- ❌ **Do NOT** generate duplicate documentation if it already exists

#### When TO Generate Documents

- ✅ **Only when explicitly asked**: "Generate documentation for...", "Create a guide for...", "Document this feature..."
- ✅ **For critical tasks**: When documentation is essential to complete a task
- ✅ **For complex features**: When a feature is non-obvious and needs explanation
- ✅ **For reference**: When user specifically requests API reference or technical specs

#### Documentation Generation Guidelines

1. **Check Before Creating**
   - Always check if documentation already exists before generating
   - Don't duplicate existing docs in `generated/docs-copilot/`
   - Reference existing docs instead of creating new ones

2. **Be Concise**
   - Keep documentation brief and focused
   - Avoid unnecessary examples or lengthy explanations
   - Include only essential information

3. **Use Existing Formats**
   - Follow the structure defined in `generated/docs-copilot/`
   - Keep file names consistent and organized
   - Use markdown for all documentation

4. **Report Generation**
   - Only generate test reports when explicitly requested
   - Don't auto-run analysis unless asked
   - Keep reports in `generated/docs-copilot/reports/`

### Default Behavior

- **Default**: No document generation - focus on code changes
- **Priority**: Code changes > Minimal documentation > Excessive documentation
- **Philosophy**: Show, don't document - demonstrate with code examples rather than lengthy prose

### When Requesting Documentation

If you want documentation generated, explicitly state:
- What type of documentation (guide, reference, report, example)
- What it should cover
- Where it should be saved
- Any specific format or structure preferences

Example good request:
```
"Generate a brief setup guide for the React 19 features in the demos/ directory"
```

Example to avoid:
```
"Document the project" (too vague, too broad)
```

## Terminal Command Guidelines

When running commands in the terminal, use **Git Bash style** commands:

### Path Conventions

- Use **forward slashes** `/` instead of backslashes `\`
- Use `~` for home directory (e.g., `~/project` instead of `C:\Users\username\project`)
- Use relative paths when possible (e.g., `./src/components`)

Example:
```bash
# ✓ Correct - Git Bash style
cd ~/Documents/WebStorm/reactjs-upgrade-playground
pnpm install
ls -la ./src/features/react19/demos

# ✗ Incorrect - Windows style
cd C:\Users\nobu\Documents\WebStorm\reactjs-upgrade-playground
pnpm install
dir src\features\react19\demos
```

### Common Git Bash Commands

```bash
# Directory navigation
pwd                    # Print working directory
cd path/to/directory   # Change directory
ls                     # List files
ls -la                 # List files with details
mkdir -p path/to/dir   # Create directory structure

# File operations
cat filename           # Display file contents
cp source/file dest/   # Copy file
mv source/file dest/   # Move/rename file
rm filename            # Remove file
rm -rf directory       # Remove directory recursively

# Search and find
find . -name "*.tsx"   # Find files by pattern
grep -r "text" ./src   # Search text in files
grep --include="*.ts" -r "pattern" ./src

# Git commands
git status             # Check git status
git add .              # Stage all changes
git commit -m "message"  # Commit changes
git branch             # List branches
git checkout -b new-branch  # Create new branch
git pull origin main   # Pull latest changes

# pnpm commands (same across platforms)
pnpm install
pnpm add package-name
pnpm remove package-name
pnpm run script-name
```

### Environment-Specific Considerations

When running scripts that differ between platforms:

```bash
# ✓ Use pnpm scripts (cross-platform)
pnpm test-unit
pnpm lint
pnpm build

# ✓ Use Git Bash style for file operations
mkdir -p generated/docs-copilot
find ./src -name "*.test.tsx"

# ✓ Combine with proper path handling
cd ~/project && pnpm typecheck && pnpm lint
```

## Resources

- [React 19 Docs](https://react.dev)
- [Next.js Docs](https://nextjs.org/docs)
- [tRPC Docs](https://trpc.io)
- [Prisma Docs](https://www.prisma.io/docs)
- [Tailwind CSS Docs](https://tailwindcss.com/docs)
- [Git Bash Documentation](https://gitforwindows.org/)
- [pnpm Documentation](https://pnpm.io/)

